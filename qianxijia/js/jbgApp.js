// JavaScript Document
var ajaxPath="http://m.jiabangougo.com",payPath="http://m.jiabangougo.com";angular.module("starter",["ionic","starter.controllers","starter.services","ionicLazyLoad"]).run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c){c.platform.android.tabs.position("bottom"),c.tabs.style("standard"),a.state("tab",{url:"/tab",cache:!1,controller:"tabCtl",templateUrl:"templates/tabs.html"}).state("tab.dash",{url:"/dash",cache:!1,views:{"tab-dash":{templateUrl:"templates/tab-dash.html",controller:"DashCtrl"}}}).state("tab.act",{url:"/act",cache:!1,views:{"tab-act":{templateUrl:"templates/tab-act.html",controller:"DashCtrl"}}}).state("tab.chatDetail",{url:"/chats/:chatId",cache:!1,views:{"tab-dash":{templateUrl:"templates/chat-detail.html",controller:"ChatDetailCtrl"}}}).state("tab.chatcart",{url:"/chatcart",cache:!1,views:{"tab-chatcart":{templateUrl:"templates/tab-chatcart.html",controller:"chatCtrl"}}}).state("rank",{url:"/rank/:id",templateUrl:"templates/rank.html",cache:!1,controller:"rankCtrl"}).state("choseTime",{url:"/chosetime",templateUrl:"templates/chooseTime.html",cache:!1,controller:"timeCtrl"}).state("regist",{url:"/regist",templateUrl:"templates/regist.html",controller:"loginCtrl"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"loginCtrl"}).state("findPwd",{url:"/findPwd",templateUrl:"templates/findPwd.html",controller:"loginCtrl"}).state("haslogindinner",{url:"/haslogindinner",cache:!1,templateUrl:"templates/haslogindinner.html",controller:"haslogindinCtl"}).state("tab.userCenter",{url:"/userCenter",cache:"false",views:{"tab-account":{templateUrl:"templates/tab-userCenter.html",controller:"AccountCtrl"}}}).state("tab.myMoneyBag",{url:"/myMoneyBag",cache:"false",views:{"tab-account":{templateUrl:"templates/myMoneyBag.html",controller:"myAccountController"}}}).state("tab.telVerify",{url:"/telVerify",views:{"tab-account":{templateUrl:"templates/telVerify.html",controller:"AccountCtrl"}}}).state("tab.noLoginBill",{url:"/noLoginBill",views:{"tab-account":{templateUrl:"templates/noLoginBill.html",controller:"noLogBillCtrl"}}}).state("tab.mybill",{url:"/myBill",views:{"tab-account":{templateUrl:"templates/myBill.html",controller:"myBillController"}}}).state("pay",{url:"/pay/:orderId/:amount/:couponValue/:balanceValue",templateUrl:"templates/payMethod.html",controller:"payController"}).state("chooseCoupon",{url:"/chooseCoupon",templateUrl:"templates/chooseCoupon.html",controller:"chooseCouponController"}).state("paySucc",{url:"/paySucc",templateUrl:"templates/paySucc.html",controller:"payController"}).state("tab.myYhq",{url:"/myYhq",views:{"tab-account":{templateUrl:"templates/myYhq.html",controller:"myYhqController"}}}).state("tab.addM",{url:"/addM",cache:"false",views:{"tab-account":{templateUrl:"templates/addressManage.html",controller:"myAddressController"}}}).state("tab.selectAddr",{url:"/selectAddr",views:{"tab-account":{templateUrl:"templates/selectAddr.html",controller:"myAddressController"}}}).state("tab.newAddress",{url:"/newAddress",views:{"tab-account":{templateUrl:"templates/newAddress.html",controller:"myAddressController"}}}).state("tab.bindYhq",{url:"/bindYhq",views:{"tab-account":{templateUrl:"templates/bindYhq.html",controller:"myYhqController"}}}).state("tab.myAccount",{url:"/myAccount",views:{"tab-account":{templateUrl:"templates/myAccount.html",controller:"myAccountController"}}}).state("shaid",{url:"/shaid/:id",templateUrl:"templates/shaid.html",controller:"shaidController"}).state("shaid2",{url:"/shaid2/:id",templateUrl:"templates/shaid2.html",controller:"shaid2Controller"}).state("comment",{url:"/comment/:id",templateUrl:"templates/comment.html",controller:"commentController"}),b.otherwise("/tab/dash")}]),angular.module("starter.controllers",["ionic","pickadate"]).controller("homeCtrl",["$scope","$rootScope","shopList","shopDetail","$interval","verifCode","$state","$ionicActionSheet","$ionicLoading","$ionicBackdrop","$ionicPopup","$ionicModal","$location","$timeout","login",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var a=new Date,b=a.getFullYear(),c=a.getMonth(),d=a.getDate();return++c,c=10>c?"0"+c:c,nowtimes=b+"-"+c+"-"+d,nowtimes}function q(){var b=0,c=0;b+=a.ranks.buyCount*a.ranks.goodsPrice,angular.forEach(a.ranks.packageGoods,function(a){c+=a.goodsPrice*a.goodsCount}),a.allprice=b+c}$("#tabNav").show();var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);b.base64encode=function(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";d>c;){if(e=255&a.charCodeAt(c++),c==d){b+=r.charAt(e>>2),b+=r.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=r.charAt(e>>2),b+=r.charAt((3&e)<<4|(240&f)>>4),b+=r.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=r.charAt(e>>2),b+=r.charAt((3&e)<<4|(240&f)>>4),b+=r.charAt((15&f)<<2|(192&g)>>6),b+=r.charAt(63&g)}return b},b.base64decode=function(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";g>f;){do b=s[255&a.charCodeAt(f++)];while(g>f&&-1==b);if(-1==b)break;do c=s[255&a.charCodeAt(f++)];while(g>f&&-1==c);if(-1==c)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=s[d]}while(g>f&&-1==d);if(-1==d)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=s[e]}while(g>f&&-1==e);if(-1==e)break;h+=String.fromCharCode((3&d)<<6|e)}return h},b.utf16to8=function(a){var b,c,d,e;for(b="",d=a.length,c=0;d>c;c++)e=a.charCodeAt(c),e>=1&&127>=e?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b},b.utf8to16=function(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;d>c;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b},b.ifsmodal=!0;var t=window.navigator.userAgent.toLowerCase();if("micromessenger"==t.match(/MicroMessenger/i)?a.isWx=!0:a.isWx=!1,storage=window.localStorage,sessionStorage=window.sessionStorage,storage.setItem("ifLogin",!1),a.arr={},a.arr.cartLength=0,storage.payMethod="",nowtimes="",storage.first){var u=storage.first;p(),u=u.split("-"),nowtime=nowtimes.split("-");for(var v=0;3>v;v++)nowtime[v]>u[v]&&c.all().success(function(a){storage.setItem("shoplist",JSON.stringify(a))})}else p(),storage.setItem("first",nowtimes);a.tiaoCart=function(){ifNow=!1,g.go("tab.chatcart")};var w=p()+"";w=w.split("-"),w[2]=w[2]<10?"0"+w[2]:w[2];var x=w.join("-");if(a.mindat=x,storage.shopCart){var y=storage.shopCart,z=0;if(y=JSON.parse(y),0==y)a.arr.cartLength=0;else if(y instanceof Array==0)a.arr.cartLength=y.buyCount;else{for(var v=0;v<y.length;v++)z+=y[v].buyCount;a.arr.cartLength=z}}else a.arr.cartLength=0,storage.setItem("shopCart",0);storage.getItem("shoplist")||(i.show(),c.all().success(function(a){storage.setItem("shoplist",JSON.stringify(a)),i.hide()})),guige=function(){for(var b=0;b<datas.wmGoodsPicList.length;b++)1==datas.wmGoodsPicList[b].picType&&(a.ranksImg=datas.wmGoodsPicList[b]);a.ranks=datas;var c=a.ranks.hasPei,d=[];c=c.split(",");for(var b=0;b<c.length;b++)d.push(c[b].split("#"));a.opeicaiA=d,a.oAll.push(datas),a.shopDetails=datas;var e=0,f=0;e+=a.ranks.buyCount*datas.goodsPrice,angular.forEach(datas.packageGoods,function(a){f+=a.goodsPrice*a.goodsCount}),a.allprice=e+f},a.oAll=[],a.ranks="",a.ifJoin=ifJoin=!1,a.buyNow=buyNow=function(b){ifNow=!0,ifJoin=!1,a.ifJoin=!1;var c="",e=!1;if(datas="",storage.getItem("shopMain")){c=JSON.parse(storage.shopMain);for(var f=0;f<c.length;f++)if(c[f].wmGoodsId==b){datas=c[f];for(var f=0;f<datas.wmGoodsPicList.length;f++)1==datas.wmGoodsPicList[f].picType&&(datas.smallIcon=datas.wmGoodsPicList[f].imageSrc);storage.setItem("shopOnce",JSON.stringify(datas)),e=!0,guige()}e||d.all(b).success(function(b){a.shopDetails=b,datas=b;for(var c=0;c<b.wmGoodsPicList.length;c++)1==b.wmGoodsPicList[c].picType&&(b.smallIcon=b.wmGoodsPicList[c].imageSrc);guige(),storage.setItem("shopOnce",JSON.stringify(b))})}else d.all(b).success(function(b){a.shopDetails=b,datas=b;for(var c=0;c<b.wmGoodsPicList.length;c++)1==b.wmGoodsPicList[c].picType&&(b.smallIcon=b.wmGoodsPicList[c].imageSrc);storage.setItem("shopMain",JSON.stringify(b)),storage.setItem("shopOnce",JSON.stringify(b)),guige()})},a.joinCarts=function(b){if(storage.getItem("shopMain")){var c=JSON.parse(storage.shopMain),e=!1;if(c instanceof Array==0)c.wmGoodsId==b&&(e=!0,ifJoin=!0,window.location.href="#/rank/"+b);else for(var f=0;f<c.length;f++)c[f].wmGoodsId==b&&(e=!0,ifJoin=!0,window.location.href="#/rank/"+b);e||d.all(b).success(function(a){var c=[];if(JSON.parse(storage.shopMain)instanceof Array==0)c.push(JSON.parse(storage.shopMain));else for(var d=0;d<JSON.parse(storage.shopMain).length;d++)c[d]=JSON.parse(storage.shopMain)[d];c.push(a),storage.setItem("shopMain",JSON.stringify(c)),ifJoin=!0,window.location.href="#/rank/"+b})}else d.all(b).success(function(c){storage.setItem("shopMain",JSON.stringify(c)),a.shopDetails=c,ifJoin=!0,a.ifJoin=!0,window.location.href="#/rank/"+b})},a.goHome=function(){g.go("tab.dash"),$(".tab-nav").show()},a.goActive=function(){g.go("tab.act")},a.goUserCenter=function(){sessionStorage.setItem("loginToWhere","tab/userCenter"),o.isLogSrv().success(function(a){console.log(a.result),0==a.result?g.go("login"):g.go("tab.userCenter")})},a.goCart=function(){g.go("tab.chatcart"),$(".tab-nav").show(),ifNow=!1},a.goLogin=function(a){g.go("login"),1==a?(g.go("login"),storage.setItem("logToHas","1")):0==a&&(g.go("login"),storage.setItem("logToHas","0"))},a.goRegist=function(){g.go("regist")},a.wxIcon=!1,a.show=function(b){var c="李子坝梁山鸡",d="李子坝梁山鸡";if(a.removeBack=function(){j.release(),a.wxIcon=!1},a.wxfrend=!1,a.wxquan=!1,a.isWx)var e=h.show({buttons:[{text:'<a class="shareIcon" href="javascript:;" rel="sina" target="_blank"><img src="img/sinaLogo.png" alt=""><span>新浪微博</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="tengxun" target="_blank"><img src="img/tx.png" alt=""><span>腾讯微博</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="qzone" target="_blank"><img src="img/qq.png" alt=""><span>QQ空间</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="souhu" target="_blank"><img src="img/sohu.png" alt=""><span>搜狐</span></a>'},{text:'<a class="shareIcon" href="javascript:;" ng-show="isWx" rel="pengyou" target="_blank"><img src="img/frend.png" alt=""><span>朋友圈</span></a>'},{text:'<a class="shareIcon" href="javascript:;" ng-show="isWx" rel="weixin" target="_blank"><img src="img/wx.png" alt=""><span>微信好友</span></a>'}],cancelText:"取消",buttonClicked:function(b){if(4==b)e(),a.wxquan=!0,a.wxIcon=!0,j.retain();else if(5==b)e(),a.wxfrend=!0,a.wxIcon=!0,j.retain();else{var f=["http://v.t.sina.com.cn/share/share.php?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://v.t.qq.com/share/share.php?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://t.sohu.com/third/post.jsp?title="+c+"→来自页面"+d+"&url="+window.location.href];window.location.href=f[b]}}});else var e=h.show({buttons:[{text:'<a class="shareIcon" href="javascript:;" rel="sina" target="_blank"><img src="img/sinaLogo.png" alt=""><span>新浪微博</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="tengxun" target="_blank"><img src="img/tx.png" alt=""><span>腾讯微博</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="qzone" target="_blank"><img src="img/qq.png" alt=""><span>QQ空间</span></a>'},{text:'<a class="shareIcon" href="javascript:;" rel="souhu" target="_blank"><img src="img/sohu.png" alt=""><span>搜狐</span></a>'}],cancelText:"取消",buttonClicked:function(a){var b=["http://v.t.sina.com.cn/share/share.php?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://v.t.qq.com/share/share.php?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+c+"→来自页面"+d+"&url="+window.location.href,"http://t.sohu.com/third/post.jsp?title="+c+"→来自页面"+d+"&url="+window.location.href];window.location.href=b[a]}})},a.viewComment=function(a){window.location.href="#/comment/"+a},a.banners=[{url:"http://ma.jiabangougo.com/zmhd2/818H5/index.html",src:"img/818.jpg?t=201507311706"},{url:"http://m.jiabangougo.com/index2.html?t=1438937585388#/tab/chats/:136",src:"img/sjdx.jpg?t=201507311706"},{url:"http://m.jiabangougo.com/banner2.html",src:"img/banner5.jpg"},{url:"http://m.jiabangougo.com/index2.html#/tab/chats/:103",src:"img/banner3.jpg"}],a.iftopzoro=!1,a.ifModal=!0,a.slides=!1,a.showalts=function(b,c){if(a.ifModal=!1,a.slides=!0,1==c){storage.setItem("ifNow",!0),a.ifJoin=!1,id=b,a.isEdit=!1;buyNow(b),odata=JSON.parse(storage.shopOnce),datas=odata,guige(),oshops=storage.shopOnce}else if(2==c){storage.setItem("ifNow",!1),a.ifJoin=!0,id=b;var d=JSON.parse(storage.shopMain);if(d instanceof Array==0)datas=d,odata=datas,guige3();else for(var f=0;f<d.length;f++)d[f].wmGoodsId==id&&(datas=d[f],odata=datas,guige3())}else if(4==c){storage.setItem("ifNow",!0),a.ifJoin=!1,id=b,a.isEdit=!1;odata=JSON.parse(storage.shopOnce),datas=odata,guige(),oshops=storage.shopOnce}else if(5==c){if(a.ifJoin=!1,storage.setItem("ifNow",!1),id=b,odata=JSON.parse(storage.shopCart),odata instanceof Array==0)datas=odata,guige2();else for(var f=0;f<odata.length;f++)odata[f].wmGoodsId==id&&(datas=odata[f],guige2());oshops=storage.shopCart}else{if(a.ifJoin=!1,storage.setItem("ifNow",!1),id=b,odata=JSON.parse(storage.shopCart),odata instanceof Array==0)datas=odata,guige2();else for(var f=0;f<odata.length;f++)odata[f].wmGoodsId==id&&(datas=odata[f],guige2());oshops=storage.shopCart}e(function(){$(".g-detail").height()>0&&$(".ranks .scroll-content").css({top:$(".g-detail").height()+37+"px"})},30)},a.closeModal=function(){a.ifModal=!0,a.slides=!1};a.remove=remove=function(b){var c=JSON.parse(storage.shopCart);if(c instanceof Array==0)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0;else if(1==c.length)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0;else for(var d=0;d<c.length;d++)if(c[d].wmGoodsId==b){c.splice(d,1),storage.setItem("shopCart",JSON.stringify(c)),a.carts=c,a.allprice=0,all=0,alls=0;for(var d=0;d<c.length;d++){alls+=c[d].buyCount,all+=c[d].goodsPrice*c[d].buyCount;for(var e=c[d].packageGoods,f=0;f<e.length;f++)all+=e[f].goodsPrice*e[d].goodsCount}a.allprice=all,a.arr.cartLength=alls}},oaaa=!1,a.showto=function(){sessionStorage.loginToWhere="haslogindinner",i.show({template:"成功加入购物车！"});var b=JSON.parse(storage.shopCart);if(0==b){for(var c=0;c<odata.wmGoodsPicList.length;c++)1==odata.wmGoodsPicList[c].picType&&(odata.smallIcon=odata.wmGoodsPicList[c].imageSrc);storage.setItem("shopCart",JSON.stringify(odata)),a.ifModal=!0,a.slides=!1}else if(b instanceof Array==0){if(b.wmGoodsId!=odata.wmGoodsId){var d=[];d.push(b),d.push(odata);for(var e=0;e<d.length;e++)for(var c=0;c<d[e].wmGoodsPicList.length;c++)1==d[e].wmGoodsPicList[c].picType&&(d[e].smallIcon=d[e].wmGoodsPicList[c].imageSrc);storage.setItem("shopCart",JSON.stringify(d))}else{b.buyCount+=odata.buyCount;for(var c=0;c<b.packageGoods.length;c++)b.packageGoods[c].goodsCount+=odata.packageGoods[c].goodsCount;for(var c=0;c<b.wmGoodsPicList.length;c++)1==b.wmGoodsPicList[c].picType&&(b.smallIcon=b.wmGoodsPicList[c].imageSrc);storage.setItem("shopCart",JSON.stringify(b))}a.ifModal=!0,a.slides=!1}else{ifyou=!0;for(var c=0;c<b.length;c++)if(b[c].wmGoodsId==id){b[c].buyCount+=odata.buyCount;for(var e=0;e<b[c].packageGoods.length;e++)b[c].packageGoods[e].goodsCount+=odata.packageGoods[e].goodsCount;for(var f=0;f<b[c].wmGoodsPicList.length;f++)1==b[c].wmGoodsPicList[f].picType&&(b[c].smallIcon=b[c].wmGoodsPicList[f].imageSrc);storage.setItem("shopCart",JSON.stringify(b)),ifyou=!1;break}if(ifyou){var d="";d=b,d.push(odata);for(var e=0;e<d.length;e++)for(var c=0;c<d[e].wmGoodsPicList.length;c++)1==d[e].wmGoodsPicList[c].picType&&(d[e].smallIcon=d[e].wmGoodsPicList[c].imageSrc);storage.setItem("shopCart",JSON.stringify(d))}a.ifModal=!0,a.slides=!1}n(function(){i.hide()},1e3);var g=0,h=JSON.parse(storage.shopCart);if(void 0==h.length)g=h.buyCount;else for(var c=0;c<h.length;c++)g+=h[c].buyCount,console.log(g);a.arr.cartLength=g},guige2=function(){if(void 0==datas.wmGoodsPicList)window.location.href="#/tab/dash";else{for(var b=0;b<datas.wmGoodsPicList.length;b++)1==datas.wmGoodsPicList[b].picType&&(a.ranksImg=datas.wmGoodsPicList[b]);a.ranks=datas;var c=a.ranks.hasPei,d=[];c=c.split(",");for(var b=0;b<c.length;b++)d.push(c[b].split("#"));a.opeicaiA=d,a.oAll.push(datas),a.shopDetails=datas;var e=0,f=0;e+=a.ranks.buyCount*datas.goodsPrice,angular.forEach(datas.packageGoods,function(a){f+=a.goodsPrice*a.goodsCount}),a.allprice=e+f}},guige3=function(){for(var b=0;b<datas.wmGoodsPicList.length;b++)1==datas.wmGoodsPicList[b].picType&&(a.ranksImg=datas.wmGoodsPicList[b]);a.ranks=datas;var c=a.ranks.hasPei,d=[];c=c.split(",");for(var b=0;b<c.length;b++)d.push(c[b].split("#"));a.opeicaiA=d,a.oAll.push(datas),a.shopDetails=datas;var e=0,f=0;e+=a.ranks.buyCount*datas.goodsPrice,angular.forEach(datas.packageGoods,function(a){f+=a.goodsPrice*a.goodsCount}),a.allprice=e+f},a.peiAdd=function(b){a.ranks.buyCount>0&&(++a.ranks.packageGoods[b].goodsCount,q())},a.peiLess=function(b){--a.ranks.packageGoods[b].goodsCount,q()},a.less=function(){a.ranks.buyCount<=1?(a.ranks.buyCount=1,ifJoin||ifNow?a.ranks.buyCount=1:a.ranks.buyCount=1):--a.ranks.buyCount,q()},a.add=function(){++a.ranks.buyCount,q()},ifJoin&&(a.ifJoin=!0),a.buydinner=function(){sessionStorage.loginToWhere="haslogindinner";for(var b=0;b<odata.length;b++)odata[b].wmGoodsId==id&&(odata[b]=a.ranks);ifNow=storage.ifNow,"true"==ifNow?(storage.setItem("shopOnce",JSON.stringify(odata)),a.ifModal=!0,"/haslogindinner"==m.$$path?(alert("金额发生变化，请重选优惠券"),storage.couponValue=0,storage.couponId="",window.location.reload()):(storage.setItem("logUserAddr",""),window.location.href="#/chosetime")):(storage.setItem("shopCart",JSON.stringify(odata)),a.ifModal=!0,window.location.reload());for(var c=0,d=JSON.parse(storage.shopCart),b=0;b<d.length;b++)c+=d[b].buyCount;a.arr.cartLength=c},a.iftopzoro=!1}]).controller("DashCtrl",["$scope","shopList","$timeout","$rootScope","$ionicLoading","shopDetail","$interval",function(a,b,c,d,e,f,g){if(a.iftopzoro=!1,storage.setItem("changeFp",""),storage.setItem("companyName",""),storage.setItem("iffapiao",""),storage.setItem("beizhus",""),dinner={mid:!0,goodnight:!1},a.dinner=dinner,a.ifnows=!0,d.changeDinner=function(b){"m"==b?(dinner.mid=!0,a.ifnows=!0):(dinner.mid=!1,a.ifnows=!1)},$(".tab-nav").show(),storage.getItem("shopOnce")&&(storage.setItem("shopOnce",""),ifNow=!1),storage.getItem("shoplist")){a.shoplists=JSON.parse(storage.shoplist);for(var h=JSON.parse(storage.shoplist),i=[],j=[],k=[],l=0;l<h.length;l++)"正餐"==h[l].goods_subtypeName?j.push(h[l]):"夜宵"==h[l].goods_subtypeName?k.push(h[l]):(j.push(h[l]),k.push(h[l])),f.all(h[l].wmGoodsId).success(function(a){i.push(a),storage.setItem("shopMain",JSON.stringify(i))});a.shoplists=j,a.shoplistss=k}else b.all().success(function(b){storage.setItem("shoplist",JSON.stringify(b)),a.shoplists=b;for(var c=[],d=[],e=[],g=0;g<b.length;g++)"正餐"==b[g].goods_subtypeName?d.push(b[g]):"夜宵"==b[g].goods_subtypeName?e.push(b[g]):(d.push(b[g]),e.push(b[g])),f.all(b[g].wmGoodsId).success(function(a){c.push(a),storage.setItem("shopMain",JSON.stringify(c))});a.shoplists=d,a.shoplistss=e});a.joinCart=function(b){if(storage.getItem("shopMain")){var c=JSON.parse(storage.shopMain),d=!1;if(c instanceof Array==0)c.wmGoodsId==b&&(d=!0,ifJoin=!0,window.location.href="#/rank/"+b);else for(var e=0;e<c.length;e++)c[e].wmGoodsId==b&&(d=!0,ifJoin=!0,window.location.href="#/rank/"+b);d||f.all(b).success(function(a){var c=[];if(JSON.parse(storage.shopMain)instanceof Array==0)c.push(JSON.parse(storage.shopMain));else for(var d=0;d<JSON.parse(storage.shopMain).length;d++)c[d]=JSON.parse(storage.shopMain)[d];c.push(a),storage.setItem("shopMain",JSON.stringify(c)),ifJoin=!0,window.location.href="#/rank/"+b})}else f.all(b).success(function(c){storage.setItem("shopMain",JSON.stringify(c)),a.shopDetails=c,ifJoin=!0,window.location.href="#/rank/"+b})},a.zanBtn=function(b){0==a.shoplists[b].isActive&&(a.shoplists[b].isActive=!a.shoplists[b].isActive,++a.shoplists[b].zan)};var m=g(function(){$(".newIndex .slider-slide").length>0&&($(".newIndex .slider-slide").height($(window).width()/1.893+"px"),clearInterval(m))},30)}]).controller("ChatDetailCtrl",["$scope","$stateParams","shopDetail","$timeout","$rootScope","$ionicLoading","$state","$ionicSlideBoxDelegate","$interval",function(a,b,c,d,e,f,g,h,i){storage.setItem("changeFp",""),storage.setItem("companyName",""),storage.setItem("iffapiao",""),storage.setItem("beizhus","");var j=b.chatId,k=j.substring(1),l=[],m=[];if(f.show(),$(".tab-nav").hide(),storage.shopCart){var n=storage.shopCart,o=0;if(n=JSON.parse(n),0==n)a.arr.cartLength=0;else if(n instanceof Array==0)a.arr.cartLength=n.buyCount;else{for(var p=0;p<n.length;p++)o+=n[p].buyCount;a.arr.cartLength=o,console.log(o)}}else a.arr.cartLength=0,storage.setItem("shopCart",0);for(var q=JSON.parse(storage.shoplist),r=[],p=0;p<q.length;p++)r[p]=q[p];for(var p=0;p<r.length;p++)r[p].wmGoodsId==k&&(a.talkalls=r[p]);if(storage.getItem("shopMain")){var s=JSON.parse(storage.shopMain),t=!1;if(void 0==s.length){if(s.wmGoodsId==k){t=!0,a.shopDetails=s;for(var u=s.wmGoodsPicList,p=0;p<u.length;p++)5==u[p].picType?l.push(u[p]):3==u[p].picType&&m.push(u[p]);a.oAvatar=l,a.oPicdetail=m,f.hide()}}else for(var p=0;p<s.length;p++)if(s[p].wmGoodsId==k){t=!0,a.shopDetails=s[p];for(var u=s[p].wmGoodsPicList,p=0;p<u.length;p++)5==u[p].picType?l.push(u[p]):3==u[p].picType&&m.push(u[p]);return a.oAvatar=l,a.oPicdetail=m,f.hide(),!1}t||c.all(k).success(function(b){var c=[];if(void 0==JSON.parse(storage.shopMain).length)c.push(JSON.parse(storage.shopMain));else for(var d=0;d<JSON.parse(storage.shopMain).length;d++)c[d]=JSON.parse(storage.shopMain)[d];c.push(b),a.shopDetails=b;for(var d=0;d<b.wmGoodsPicList.length;d++)5==b.wmGoodsPicList[d].picType?l.push(b.wmGoodsPicList[d]):3==b.wmGoodsPicList[d].picType&&m.push(b.wmGoodsPicList[d]);a.oAvatar=l,a.oPicdetail=m,f.hide(),storage.setItem("shopMain",JSON.stringify(c))})}else c.all(k).success(function(b){storage.setItem("shopMain",JSON.stringify(b));for(var c=0;c<b.wmGoodsPicList.length;c++)5==b.wmGoodsPicList[c].picType?l.push(b.wmGoodsPicList[c]):3==b.wmGoodsPicList[c].picType&&m.push(b.wmGoodsPicList[c]);a.oAvatar=l,a.oPicdetail=m,a.shopDetails=b,f.hide(),d(function(){h.update()},50)});var o=0,v=JSON.parse(storage.shopCart);if(0==v)a.arr.cartLength=0;else if(v instanceof Array==0)a.arr.cartLength=v.buyCount;else{for(var p=0;p<v.length;p++)o+=v[p].buyCount;a.arr.cartLength=o,console.log(o)}}]).controller("loginCtrl",["$scope","register","login","resetPwd","$interval","verifCode","$state","$ionicLoading","$location",function(a,b,c,d,e,f,g,h,i){storage.setItem("changeFp",""),storage.setItem("companyName",""),storage.setItem("iffapiao",""),storage.setItem("beizhus",""),a.showPwd="password",a.showPwdCheck=function(){"text"==a.showPwd?a.showPwd="password":a.showPwd="text"},a.formatPhoneNum=function(){var b=String(a.userphone),c=b.replace(/(.{4})/g,"$1\n\n");void 0==a.userphone?a.userphone="手机号码格式不对哟":a.userphone=c};var j={};j.word="获取验证码",a.yanz=j;var k=0;a.getYanz=function(b){a.cutDown=120,k=b,f.verifCodeSrv(k).success(function(b){b.result?(a.waiting=!0,e(function(){1==a.cutDown?a.waiting=!1:--a.cutDown},1e3)):(h.show({template:b.message}),setTimeout(function(){h.hide()},1e3))})},a.register=function(){a.doing=!0,b.regSrv(a.userphone,a.password).success(function(b){0==b.result?(a.doing=!1,a.reply=!0,a.replyMsg=b.message):(a.doing=!1,a.reply=!0,a.regSuc=!0,a.replyMsg=b.message,storage.setItem("ifLogin",!0),setTimeout(function(){g.go("tab.userCenter")},3e3))})},a.userLogin=function(b,d){a.doing=!0,c.logSrv(b,d).success(function(b){1==b.result?(a.doing=!1,a.regSuc=!0,a.reply=!0,a.replyMsg=b.message,sessionStorage.loginToWhere?i.path(sessionStorage.loginToWhere):i.path("chosetime"),storage.setItem("ifLogin",!0)):(a.doing=!1,a.regSuc=!1,h.show({template:b.message}),setTimeout(function(){h.hide()},1e3))})},a.getCheckCode=function(){a.cutDown=120,a.waiting=!0,f.verifCodeSrv(a.userphone).success(function(b){b.result?(a.waiting=!0,e(function(){1==a.cutDown?a.waiting=!1:--a.cutDown},1e3)):(h.show({template:b.message}),setTimeout(function(){h.hide()},1e3))})},a.changePwdBtn=function(){a.doing=!0,d.resetPwdSrv(a.userphone,a.password,a.checkCode).success(function(b){b.result?(a.doing=!1,a.reply=!0,a.regSuc=!0,a.replyMsg=b.message,setTimeout(function(){g.go("login")},1e3)):(a.doing=!1,a.reply=!0,a.regSuc=!1,a.replyMsg=b.message)})},a.continueBuy=function(){1==storage.logToHas?setTimeout(function(){g.go("haslogindinner")},1e3):0==storage.logToHas&&setTimeout(function(){g.go("tab.dash")},1e3)}}]).controller("AccountCtrl",["$scope","login","userCenter","verifCode","$interval","$state","$ionicLoading","myBill",function(a,b,c,d,e,f,g,h){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan",""),a.userphone=storage.userName,$(".tab-nav").show();var i=0;h.getNoPayBillSrv(i).success(function(b){a.NoPayNum=b.length}),h.getMyBillSrv(i).success(function(b){a.MyBillNum=b.length}),h.getBillCommentSrv(i).success(function(b){a.BillCommentNum=b.length});var j=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=("00"+a.charCodeAt(c).toString(16)).slice(-4);return"\\u"+b.join("\\u")};b.isLogSrv().success(function(b){b.result?(storage.userId=b.user.userId,storage.setItem("ifLogin",!0),a.isLogin=b.result,a.userName=b.user.userName,a.userInforHead=b.user.headImgUrl,""!=b.user.wxUserName?a.userInforName=b.user.wxUserName:a.userInforName=b.user.userName,a.userInforTel=b.user.userPhone,a.userNameUrl=encodeURI(j(a.userInforName)),console.log(a.userNameUrl),storage.shareUrl="share.html?userId="+storage.userId+"&userName="+a.userNameUrl+"&userAvator="+a.userInforHead):f.go("login")}),a.share=function(){window.location.href=storage.shareUrl},a.signOut=function(){c.SignOutSrv().success(function(a){f.go("login")})},a.myBill=function(){f.go("tab.mybill")},a.addressManage=function(){f.go("tab.addM"),storage.setItem("ifSelectAddr","2")},a.myMoneyBag=function(){f.go("tab.myMoneyBag")},a.noPay=function(){storage.billType=1,f.go("tab.mybill",{},{reload:!0})},a.noRecive=function(){storage.billType=2,f.go("tab.mybill",{},{reload:!0})},a.noComment=function(){storage.billType=3,f.go("tab.mybill",{},{reload:!0})},a.doneBill=function(){storage.billType=4,f.go("tab.mybill",{},{reload:!0})},a.refundBill=function(){storage.billType=5,f.go("tab.mybill",{},{reload:!0})}}]).controller("myAccountController",["$scope","$state","myAccount","$interval","myCoupon",function(a,b,c,d,e){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan",""),c.myAccountSrv().success(function(b){a.accountBalance=JSON.stringify(b)}),a.myMoneyBag=function(){b.go("tab.myMoneyBag")},a.yhqLength=0,e.myCouponSrv().success(function(b){for(var c=b.length,d=0;c>d;d++)1==b[d].state&&(a.yhqLength+=1)}),c.myAccountListSrv().success(function(b){a.accountList=b}),a.myYouHuQuan=function(){b.go("tab.myYhq")},a.myAccount=function(){b.go("tab.myAccount")}}]).controller("faHongBao",["$scope","faHongBao","$stateParams","verifCode","$ionicLoading","$interval",function(a,c,d,e,f,g){a.isRegist=function(){c.isRegisterSrv(a.userphone).success(function(b){0==b.result&&(-1==b.resultCode?(a.doing=!1,a.regSuc=!1,f.show({template:b.message}),setTimeout(function(){window.location.href="http://m.jiabangougo.com/"},1e3)):(a.doing=!1,a.regSuc=!1,f.show({template:b.message}),setTimeout(function(){f.hide()},1e3)))})};var h=(storage.userId,window.location.href),i=h.indexOf("="),j=h.indexOf("&");h.indexOf("&")>=0?b=h.substring(i+1,j):b=h.substring(i+1),a.userLogin=function(d){a.doing=!0,c.bindUserSrv(b).success(function(b){c.logSrv(a.userphone,d).success(function(b){if(1==b.result){a.doing=!1,a.regSuc=!0,a.reply=!0,a.replyMsg=b.message;var c=a.userphone;localStorage.setItem("userName",c),window.location.href="http://m.jiabangougo.com/invite-s.html",storage.setItem("ifLogin",!0)}else a.doing=!1,a.regSuc=!1,f.show({template:b.message}),setTimeout(function(){f.hide()},1e3)})})},a.getCheckCode=function(b){a.cutDown=120,a.waiting=!0,e.verifCodeSrv(b).success(function(b){b.result?(a.waiting=!0,g(function(){1==a.cutDown?a.waiting=!1:--a.cutDown},1e3)):(f.show({template:b.message}),setTimeout(function(){f.hide()},1e3))})}}]).controller("fenFaHongBao",["$scope","faHongBao","$stateParams","verifCode","$ionicLoading","$interval","localPush",function(a,c,d,e,f,g,h){a.isRegist=function(){c.isRegisterSrv(a.userphone).success(function(a){0==a.result&&(f.show({template:a.message}),setTimeout(function(){f.hide()},1e3))})};var i=(storage.userId,window.location.href),j=i.indexOf("="),k=i.indexOf("&");i.indexOf("&")>=0?b=i.substring(j+1,k):b=i.substring(j+1);var l=window.location.href.split("?")[1].split("#")[0].split("=")[1];a.userLogin=function(b){a.doing=!0,c.fenfa(l).success(function(d){c.fenXiaoShangBind(a.userphone,b).success(function(b){if(1==b.result){a.doing=!1,a.regSuc=!0,a.reply=!0,a.replyMsg=b.message;var c=a.userphone;localStorage.setItem("userName",c),window.location.href="http://m.jiabangougo.com/invite-s.html",storage.setItem("ifLogin",!0)}else a.doing=!1,a.regSuc=!1,f.show({template:b.message}),setTimeout(function(){f.hide()},1e3)})})},a.getCheckCode=function(b){a.cutDown=120,a.waiting=!0,e.verifCodeSrv(b).success(function(b){b.result?(a.waiting=!0,g(function(){1==a.cutDown?a.waiting=!1:--a.cutDown},1e3)):(f.show({template:b.message}),setTimeout(function(){f.hide()},1e3))})}}]).controller("localPushController",["$scope","faHongBao","localPush","$stateParams","verifCode","$ionicLoading","$interval",function(a,b,c,d,e,f,g){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan",""),urlString=window.location.href;var h=urlString.indexOf("="),i=urlString.indexOf("#");urlString.indexOf("#")>=0?key=urlString.substring(h+1,i):key=urlString.substring(h+1),a.showVerifyCode=!1,a.userLogin=function(b){a.doing=!0,c.localPushRuleSrv(key).success(function(){c.localPushlogSrv(a.userphone,b).success(function(b){1==b.result?(a.doing=!1,a.regSuc=!0,a.reply=!0,a.replyMsg=b.message,window.location.href="localRegist-s.html",storage.setItem("ifLogin",!0)):(a.doing=!1,a.regSuc=!1,f.show({template:b.message}),setTimeout(function(){f.hide()},1e3))})})},a.getCheckCode=function(b){a.cutDown=120,a.waiting=!0,e.verifCodeSrv(b).success(function(b){b.result?(a.showVerifyCode=!0,a.waiting=!0,g(function(){1==a.cutDown?a.waiting=!1:--a.cutDown},1e3)):(f.show({template:b.message}),a.waiting=!1,setTimeout(function(){f.hide()},1e3))})}}]).controller("myBillController",["$rootScope","$scope","myBill","$ionicLoading","$ionicPopup","shaid","$interval",function(a,b,c,d,e,f,g){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan","");var h=0,i=Number(storage.billType);switch(i){case 1:c.getNoPayBillSrv(h).success(function(a){if(0!=a.length){b.showLoading={};for(var c=0;c<a.length;c++)b.showLoading[c]=!1;
b.orderList=a,storage.setItem("lastBillId",a[a.length-1].wmOrderId)}else b.orderList=a});break;case 2:c.getMyBillSrv(h).success(function(a){if(0!=a.length){b.showLoading={};for(var c=0;c<a.length;c++)b.showLoading[c]=!1;b.orderList=a,storage.setItem("lastBillId",a[a.length-1].wmOrderId)}else b.orderList=a});break;case 3:c.getBillCommentSrv(h).success(function(a){if(0!=a.length){b.showLoading={};for(var c=0;c<a.length;c++)b.showLoading[c]=!1;b.orderList=a,storage.setItem("lastBillId",a[a.length-1].wmOrderId)}else b.orderList=a});break;case 4:c.getMyBillDoneSrv(h).success(function(a){if(0!=a.length){b.showLoading={};for(var c=0;c<a.length;c++)b.showLoading[c]=!1;d.hide(),b.orderList=a,storage.setItem("lastBillId",a[a.length-1].wmOrderId)}else d.hide(),b.orderList=a});break;case 5:c.getRefundBillSrv(h).success(function(a){if(0!=a.length){b.showLoading={};for(var c=0;c<a.length;c++)b.showLoading[c]=!1;d.hide(),b.orderList=a,storage.setItem("lastBillId",a[a.length-1].wmOrderId)}else d.hide(),b.orderList=a})}b.getMoreMyBill=function(){var a=storage.lastBillId;1==b.tabClick?c.getMyBillSrv(a).success(function(a){if(1==a.length)storage.setItem("lastBillId",""),$(".spinner,.getMore").hide(),d.show({template:"没有更多了"}),setTimeout(function(){d.hide()},1e3);else{b.showLoading={};for(var c=0;c<a.length-1;c++)b.showLoading[c]=!1,billList.push(a[c]);b.tabClick=!0,b.orderList=billList,storage.setItem("lastBillId",billList[billList.length-1].wmOrderId),b.$broadcast("scroll.infiniteScrollComplete")}b.tabClick=1}):2==b.tabClick?c.getBillCommentSrv(a).success(function(a){if(1==a.length)storage.setItem("lastBillId",""),$(".spinner,.getMore").hide(),d.show({template:"没有更多了"}),setTimeout(function(){d.hide()},1e3);else{b.showLoading={};for(var c=0;c<a.length-1;c++)b.showLoading[c]=!1,billList.push(a[c]);b.tabClick=!0,b.orderList=billList,storage.setItem("lastBillId",billList[billList.length-1].wmOrderId),b.$broadcast("scroll.infiniteScrollComplete")}b.tabClick=2}):3==b.tabClick&&c.getMyBillDoneSrv(a).success(function(a){if(1==a.length)storage.setItem("lastBillId",""),$(".spinner,.getMore").hide(),d.show({template:"没有更多了"}),setTimeout(function(){d.hide()},1e3);else{b.showLoading={};for(var c=0;c<a.length-1;c++)b.showLoading[c]=!1,billList.push(a[c]);b.tabClick=!0,b.orderList=billList,storage.setItem("lastBillId",billList[billList.length-1].wmOrderId),b.$broadcast("scroll.infiniteScrollComplete")}b.tabClick=3})},b.showConfirm=function(a){b.showConfirm[a]=!0},b.hideConfirm=function(a){b.showConfirm[a]=!1},b.getMyBillDetail=function(a){b.showLoading[a]=!0},b.cancelBill=function(a){c.cancelOrderSrv(a).success(function(a){a.result&&(b.result=a.message,window.location.reload())})},b.payBill=function(b,c,d,e){var c=a.base64encode(a.utf16to8(c.toString())),b=a.base64encode(a.utf16to8(b.toString())),f=a.base64encode(a.utf16to8(d.toString())),g=a.base64encode(a.utf16to8(e.toString()));window.location.href="#/pay/"+c+"/"+b+"/"+f+"/"+g},b.refund=function(a){c.sendRefundSrv(a).success(function(a){a.result?(d.show({template:a.message}),setTimeout(function(){d.hide()},1e3),window.location.reload()):(d.show({template:a.message+"<br>若有疑问，请联系客服"}),setTimeout(function(){d.hide()},1e3))})},b.recive=function(a){c.sendSignSrv(a).success(function(a){a.result&&window.location.reload()})},b.goComment=function(a){window.location.href="http://m.jiabangougo.com/investigate/index.html?p1=1&p2="+storage.userId+"&p3="+a},b.showBill=function(a){f.list(a).success(function(b){for(var c=!1,e=0;e<b.length;e++)if(0==b[e].isCommented&&"0"==b[e].upGoodsId){c=!0;break}c?window.location.href="#/shaid2/"+a:(d.show({template:"没有要晒单的商品 - -"}),setTimeout(function(){d.hide()},1e3))})}}]).controller("myYhqController",["$scope","myCoupon","$state","$ionicLoading","$interval",function(a,b,c,d,e){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan",""),a.yhqVal=1,a.myMoneyBag=function(){c.go("tab.myMoneyBag")},b.myCouponSrv().success(function(b){var c=[],d=[];for(a.validityCouponList=c,a.overdueCouponList=d,i=0;i<b.length;i++)1==b[i].state?(c.push(b[i]),a.validityCouponList=c):(2==b[i].state||3==b[i].state)&&(d.push(b[i]),a.overdueCouponList=d)}),a.goBind=function(){c.go("tab.bindYhq")},a.usageCoupon=function(){a.yhqVal=1},a.overdueCoupon=function(){a.yhqVal=2},a.myYouHuQuan=function(){c.go("tab.myYhq")},a.bindYhq=function(d){a.doing=!0;var e=d.$modelValue;b.bindCouponSrv(e).success(function(b){b.result?(a.result=b.message,setTimeout(function(){c.go("tab.myYhq",{},{reload:!0})},1e3)):a.result=b.message,a.doing=!1})}}]).controller("chooseCouponController",["$scope","dinner","$interval","$state",function(a,b,c,d){b.myValidCouponSrv().success(function(b){storage.couponId="",b.result&&b.resultObj&&(a.showCouponBtn=!0,a.couponNum=b.resultObj.length),a.couponList=b.resultObj,a.couponChoose=function(c){for(a.couponArr={},i=0;i<b.length;i++)a.couponArr[i]=!1;a.couponArr[c]=!0,storage.couponValue=a.couponList[c].balance,storage.couponId=a.couponList[c].couponId,d.go("haslogindinner")}}),a.unusageCoupon=function(){storage.couponValue=0,storage.couponId="",storage.payMethod="",d.go("haslogindinner")},a.useCoupon=function(){d.go("haslogindinner")}}]).controller("payController",["$rootScope","$scope","payMethod","myAccount","$stateParams","$state","$ionicLoading","$ionicPopup","$interval","login",function(a,b,c,d,e,f,g,h,i,j){storage.clear(),orderId=a.utf8to16(a.base64decode(e.orderId)),b.amount=a.utf8to16(a.base64decode(e.amount)),b.couponValue=a.utf8to16(a.base64decode(e.couponValue)),b.balanceValue=a.utf8to16(a.base64decode(e.balanceValue)),b.orderPay=1*b.amount-1*b.couponValue-1*b.balanceValue,b.wxAlipay=function(){$(".wxAlipayTip,.mask").show(),setTimeout(function(){$(".mask").hide()},5e3)},b.payMethodBtn=function(a){switch(b.payMethod=a,a){case 1:b.wx=!0,b.zfb=!1,b.xyk=!1,storage.setItem("orderId",orderId),window.location.href="wxPay.html";break;case 2:b.wx=!1,b.zfb=!0,b.xyk=!1,c.alipaySrv(orderId).success(function(a){if(1==a.result)if("1"==a.message)f.go("paySucc");else{var c=payPath+"/alipay/wap.jsp?WIDout_trade_no="+a.widoutTradeNo+"&WIDsubject="+a.widsubject+"&WIDtotal_fee="+a.widtotalFee+"&pay_expire="+a.pay_expire+"&WINotify="+a.winotify+"&WIcall="+a.wicall+"&WImerchant="+a.wimerchant;window.location.href=c,storage.setItem("ifLogin",!1)}else g.show({template:a.message}),setTimeout(function(){g.hide()},2e3),b.doing=!1});break;case 3:b.wx=!1,b.zfb=!1,b.xyk=!0,c.bankPaySrv(orderId).success(function(a){a.result?window.location.href=a.alinPayUrl:(g.show({template:a.message}),setTimeout(function(){g.hide()},2e3),b.doing=!1)})}},b.goBuy=function(){f.go("tab.dash")},b.goBill=function(){storage.billType="2",f.go("tab.mybill")}}]).controller("myAddressController",["$scope","myBill","amap","myAddress","$state","$ionicLoading","dinner","$interval",function(a,b,c,d,e,f,g,h){$(".tab-nav").show(),d.addressListSrv().success(function(b){a.myAddressList=b}),a.show=!0;var i=!1,j=[{id:1479,name:"渝中区"},{id:1481,name:"江北区"},{id:1484,name:"南岸区"},{id:1482,name:"沙坪坝区"},{id:1480,name:"大渡口区"},{id:1483,name:"九龙坡区"},{id:1488,name:"渝北区"},{id:1489,name:"巴南区"}];if(storage.addInfor){var k=JSON.parse(storage.addInfor);$("#area").val(k.area)}a.addNewAddress=function(){e.go("tab.newAddress")},a.addNewAddressFromSelect=function(){e.go("tab.newAddress"),storage.setItem("ifSelectAddr","1")},a.saveAddress=function(){void 0==a.data.infoaddr&&(a.data.infoaddr=""),i?(f.show(),d.getOrg().success(function(b){d.save(a.data,b,function(a){a.result?(f.hide(),storage.setItem("addrId",a.resultObj.id),1==storage.ifSelectAddr?e.go("tab.selectAddr",{},{reload:!0}):e.go("tab.addM",{},{reload:!0})):(f.hide(),f.show({template:"已经有这个收货人信息了"}),setTimeout(function(){f.hide()},1e3))})})):(f.show({template:"选择一个推荐地址"}),setTimeout(function(){f.hide()},1e3))},a.cancel=function(){history.go(-1)},a.chooseAddr=function(b){storage.setItem("logUserAddr",JSON.stringify(a.myAddressList[b])),e.go("haslogindinner")},a.setDefaultAdd=function(a){var b=a;d.setDefaultAddSrv(b).success(function(a){a.result?e.go(e.current,{},{reload:!0}):(f.show({template:"对不起没设置成功，程序员正在挨板子，挨完回来修复~"}),setTimeout(function(){f.hide()},1e3))})},a.deleteAdd=function(a){var b=a;d.deleteAddSrv(b).success(function(a){a.result?e.go(e.current,{},{reload:!0}):(f.show({template:"对不起没设置成功，程序员正在挨板子，挨完回来修复~"}),setTimeout(function(){f.hide()},1e3))})},a.search=function(){i=!1,a.data.receiverAddress.length>0&&l(a.data.receiverAddress)},a.focus=function(){a.show=!1,void 0!=a.data&&l(a.data.receiverAddress)},a.blur=function(){},a.clk=function(b){if(void 0!=b.name){for(var c=0;c<j.length;c++)if(b.adname==j[c].name){a.data.area=j[c].id;break}if(""==a.data.area||void 0==a.data.area)return void alert("该地址不在配送范围内哦!!");i=!0,a.data.lng=b.location.lng,a.data.lat=b.location.lat,a.data.cityname=b.cityname,a.data.pname=b.pname,""!=b.address?a.data.receiverAddress=b.address+" "+b.name:a.data.receiverAddress=b.name,a.show=!0,a.list=[]}else f.show({template:"请选择一个推荐地址"}),setTimeout(function(){f.hide()},1e3)};var l=ionic.debounce(function(b){var d=$("#area").find("option:selected").text(),e="重庆市";void 0!=d&&""!=d&&(e=d),c.placeSearch({index:1,size:10,adcode:e,name:b,extensions:"all",success:function(b){a.$apply(function(){b.poiList.pois.push({}),b.poiList.pois.push({}),b.poiList.pois.push({}),a.list=b.poiList.pois})},error:function(){a.$apply(function(){a.list=[]})}})},0)}]).controller("chatCtrl",["$scope","$state","$ionicLoading","$interval","myAddress",function(a,b,c,d,e){storage.setItem("chooseSendtimes",""),storage.setItem("chooseSendtimesDuan",""),storage.setItem("changeFp",""),storage.setItem("companyName",""),storage.setItem("iffapiao",""),storage.setItem("beizhus",""),storage.setItem("logUserAddr",""),a.remove=remove=function(b){var c=JSON.parse(storage.shopCart);if(c instanceof Array==0)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0;else if(1==c.length)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0;else for(var d=0;d<c.length;d++)if(c[d].wmGoodsId==b){c.splice(d,1),storage.setItem("shopCart",JSON.stringify(c)),a.carts=c,a.allprice=0,l=0,alls=0;for(var d=0;d<c.length;d++){alls+=c[d].buyCount,l+=c[d].goodsPrice*c[d].buyCount;for(var e=c[d].packageGoods,f=0;f<e.length;f++)l+=e[f].goodsPrice*e[d].goodsCount}a.allprice=l,a.arr.cartLength=alls}},a.endMoney=function(){storage.setItem("ifNow",!1),ifJoin=!0,a.ifJoin=!0,e.addressListSrv().success(function(a){"未登录"==a.message?window.location.href="#/login":(storage.setItem("ifLogin",!0),window.location.href="#/chosetime")})},a.tiaoEdit=function(b){ifJoin=!1,a.ifJoin=!1,a.showalts(b,3)};var f="";if(0==storage.shopCart)a.carts=0,a.allprice=0;else if(JSON.parse(storage.shopCart)instanceof Array==0){var g=[];g.push(JSON.parse(storage.shopCart)),f=g}else f=JSON.parse(storage.shopCart);if(0!=f.length){var h="";h=f;for(var i=0;i<f.length;i++)for(var j=0;j<f[i].wmGoodsPicList.length;j++)1==f[i].wmGoodsPicList[j].picType&&(f[i].smallIcon=f[i].wmGoodsPicList[j].imageSrc);storage.setItem("shopCart",JSON.stringify(f)),a.moreActive=!1,a.ifEdits=!1;for(var k=0;k<f.length;k++)if(f[k].nopei=!1,void 0==f[k].packageGoods.length)f[k].nopei=!0;else{for(var j=0,i=0;i<f[k].packageGoods.length;i++)j+=f[k].packageGoods[i].goodsCount;0==j?f[k].nopei=!0:f[k].nopei=!1}a.carts=f;var l=0;a.allprice=0;for(var i=0;i<h.length;i++){l+=h[i].goodsPrice*h[i].buyCount;for(var m=h[i].packageGoods,j=0;j<m.length;j++)l+=m[j].goodsPrice*m[j].goodsCount}a.allprice=l,a.ismoreActive=function(b){a.carts[b].ifhides=!1,a.carts[b].moreActive=!a.carts[b].moreActive,a.carts[b].ifEdits=!a.carts[b].ifEdits,a.carts[b].moreActive?a.carts[b].isSee=!0:a.carts[b].isSee=!1}}}]).controller("haslogindinCtl",["$scope","dinner","$ionicLoading","$interval","$state","$ionicModal","$rootScope","$stateParams","myAccount","myAddress",function(a,b,c,d,e,f,g,h,i,j){function k(a){var b=new Date,c=b.getTime()+864e5*a;b.setTime(c);var d=b.getFullYear(),e=b.getMonth(),f=b.getDate(),g=b.getDay();return e=l(e+1),f=l(f),g="星期"+"日一二三四五六".charAt(g),d+"-"+e+"-"+f+"-"+g}function l(a){var b=a;return 1==a.toString().length&&(b="0"+a),b}function m(d,f){b.getAllTime(d,f).success(function(b){L=b.timeList,c.hide();for(var d=0;d<L.length;d++)L[d].timePoint=L[d].timePoint.substring(0,5),L[d].active=!1;a.wuTimeZone=[],a.wanTimeZone=[],a.yeTimeZone=[];for(var d=0;d<L.length;d++)L[d].timePoint>"08:00"&&L[d].timePoint<"14:00"?(a.wuTimeZone.push(L[d]),console.log(a.wuTimeZone)):L[d].timePoint>"14:00"&&L[d].timePoint<"21:00"?a.wanTimeZone.push(L[d]):a.yeTimeZone.push(L[d])}).error(function(){c.hide(),e.go("#/login")})}function k(a,b){var c=new Date,d=c.getTime()+864e5*a;c.setTime(d);var e=c.getFullYear(),f=c.getMonth(),g=c.getDate(),h=c.getDay();return f=l(f+1),g=l(g),h="星期"+"日一二三四五六".charAt(h),1==b?e+"-"+f+"-"+g+"-"+h:f+"-"+g+" "+h}a.chooseSendtime=storage.chooseSendtimes,p=a.chooseSendtime,a.chooseSendtimesDuan=storage.chooseSendtimesDuan,console.log(p),void 0!=p&&(p=p.substring(0,p.length-4),p=p.replace("年","-"),p=p.replace("月","-"),p=p.replace("日","-"),p=p+" "+a.chooseSendtimesDuan,storage.requireTimeForCoupon=p),void 0===storage.couponId&&(storage.couponId=""),void 0===storage.couponValue&&(storage.couponValue=0),a.couponId=storage.couponId,i.myAccountSrv().success(function(b){a.accountBalanceValue=b,sessionStorage.setItem("accountBalanceValue",b)}),a.accountBalance=0,storage.isBlance=!1,a.couponBalance=storage.couponValue,a.showCoupon=function(){e.go("chooseCoupon")},j.addressListSrv().success(function(b){if(0!=b.length)if(storage.logUserAddr){var c=JSON.parse(storage.logUserAddr);a.isHasAddr=!0,a.username=c.receiverName,a.userphone=c.receiverTel,a.userAddr=c.receiverCity+c.receiverArea+c.receiverStreet+c.receiverAddress,s=c.receiverAreaCode,u=c.receiverAddress,q=c.receiverName,r=c.receiverTel,t=c.receiverStreet,x=c.lng,w=c.lat,n=c.addrId}else a.isHasAddr=!0,a.username="没有收货人信息",a.userAddr="没有收货人地址";else a.isHasAddr=!1}),a.changeBei=function(a){""==a?storage.setItem("beizhus",""):storage.setItem("beizhus",a)},a.remove=remove=function(b){var c=JSON.parse(storage.shopCart);if(c instanceof Array==0)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0;else{if(1==c.length)storage.setItem("shopCart",0),a.carts=0,a.arr.cartLength=0,a.allprice=0,window.location.href="#/tab/dash";else for(var d=0;d<c.length;d++)if(c[d].wmGoodsId==b){c.splice(d,1),storage.setItem("shopCart",JSON.stringify(c)),a.carts=c,a.Details=c,a.allprice=0,E=0,alls=0;for(var d=0;d<c.length;d++){alls+=c[d].buyCount,E+=c[d].goodsPrice*c[d].buyCount;for(var e=c[d].packageGoods,f=0;f<e.length;f++)E+=e[f].goodsPrice*e[d].goodsCount}a.allprice=E,a.hehe=E,a.arr.cartLength=alls}var g=JSON.parse(storage.shopCart);if(y=[],0==g)window.location.href="#/tab/dash",$(".tab-nav").show();else if(g instanceof Array==0){var h="",i="";h+=g.wmGoodsId+":"+g.buyCount+"A";for(var f=0;f<g.packageGoods.length;f++)i+=0==f?g.packageGoods[f].wmGoodsId+":"+g.packageGoods[f].goodsCount:";"+g.packageGoods[f].wmGoodsId+":"+g.packageGoods[f].goodsCount;h+=i,y.push(h)}else for(var d=0;d<g.length;d++){var h="",i="";h+=g[d].wmGoodsId+":"+g[d].buyCount+"A";for(var f=0;f<g[d].packageGoods.length;f++)i+=0==f?g[d].packageGoods[f].wmGoodsId+":"+g[d].packageGoods[f].goodsCount:";"+g[d].packageGoods[f].wmGoodsId+":"+g[d].packageGoods[f].goodsCount;h+=i,y.push(h)}}},""!=storage.chooseSendtimes&&(a.chooseSendtime=storage.chooseSendtimes),""!=storage.chooseSendtimesDuan&&(a.chooseTimezone=storage.chooseSendtimesDuan),a.yaof=!1,a.setIfSelectAddr=function(){e.go("tab.newAddress"),storage.setItem("ifSelectAddr","1")},ifNow=storage.ifNow,"false"==ifNow&&(ifJoin=!0,a.ifJoin=!0);var n,o,p,q,r,s,t,u,v,w,x,y;a.reEdit=function(b){"true"==ifNow?(a.showalts(b,4),ifJoin=!1,a.ifJoin=!1):(a.showalts(b,5),ifJoin=!0,a.ifJoin=!0)},a.yao=function(){a.yaof=!a.yaof,0==a.yaof&&(a.xians=!1),1==a.yaof&&2==a.fapiao&&(a.xians=!0)},a.settingsList=[{text:"是否需要发票",checked:!1}],storage.iffapiao&&(a.settingsList[0].checked=storage.iffapiao,a.yaof=storage.iffapiao,a.settingsList=[{text:"是否需要发票",checked:storage.iffapiao}]),a.itemchange=function(){console.log(a.settingsList),a.yaof=a.settingsList[0].checked,storage.setItem("iffapiao",a.settingsList[0].checked),console.log(a.yaof)},a.today=k(0),a.tomorrow=k(1),a.after=k(2),a.others="auto";var z=k(3).split("-");a.houDate=z[0]+","+z[1]+","+z[2],a.sendDate=a.today,a.isBalance=!1,a.balanceChange=function(){a.isBalance?(a.isBalance=!1,sessionStorage.useBalance=0):(a.isBalance=!0,sessionStorage.useBalance=sessionStorage.accountBalanceValue),userPay()},a.fapiao=0,a.xians=!1,storage.xians&&(a.xians=storage.xians),a.changeFp=function(b){2==b?(a.xians=!0,storage.setItem("xians",!0)):(a.xians=!1,storage.setItem("xians","")),a.fapiao=b,invoiceType=b,storage.setItem("changeFp",b)},a.companyName=function(a){""!=a&&storage.setItem("companyName",a)},a.ifyud=!1;var A="";if("true"==ifNow){A=JSON.parse(storage.shopOnce);var B=k(A.mealRevertDay).split("-");B.pop();var C=B.join("-");if(a.mindat=C,A.mealRevertDay>0){var B=k(A.mealRevertDay).split("-");B.pop();var C=B.join("-");a.mindat=C,console.log(a.mindat),1==A.mealRevertDay?(a.ifone=!0,a.iftwo=!1,a.ifthree=!1):2==A.mealRevertDay?(a.ifone=!0,a.iftwo=!0,a.ifthree=!1):A.mealRevertDay>=3&&(a.ifone=!0,a.iftwo=!0,a.ifthree=!0,a.ifyud=!0),a.sendDate=k(A.mealRevertDay)}}else{A=JSON.parse(storage.shopCart);var B=k(0).split("-");B.pop();var C=B.join("-");a.mindat=C}var D=0,E=0;if(a.allPrices=0,0==A)a.arr.cartLength=0,window.location.href="#/tab/dash",$(".tab-nav").show();else if(A instanceof Array==0){a.arr.cartLength=A.buyCount,E+=A.goodsPrice*A.buyCount;for(var F=0;F<A.packageGoods.length;F++)E+=A.packageGoods[F].goodsCount*A.packageGoods[F].goodsPrice;a.allPrices+=E}else{for(var G=0;G<A.length;G++){D+=A[G].buyCount,E+=A[G].goodsPrice*A[G].buyCount;for(var F=0;F<A[G].packageGoods.length;F++)E+=A[G].packageGoods[F].goodsCount*A[G].packageGoods[F].goodsPrice}a.arr.cartLength=D,a.allPrices=E}if(a.hehe=a.allPrices,sgoodsId=[],a.userPay=a.hehe,userPay=function(){var b=1*storage.couponValue+1*sessionStorage.useBalance;b>=a.hehe?a.userPay=0:a.userPay=a.hehe-b},a.ifcan=!1,"true"==ifNow){""!=storage.chooseSendtimes&&(a.chooseSendtime=storage.chooseSendtimes),""!=storage.chooseSendtimesDuan&&(a.chooseTimezone=storage.chooseSendtimesDuan);var H=JSON.parse(storage.shopOnce);y="";var I="",J="";if(sgoodsId.push(H.wmGoodsId),sgoodsId=sgoodsId.join(","),storage.sgoodsId=sgoodsId,I+=H.wmGoodsId+":"+H.buyCount+"A",H.mealRevertDay>0){m(sgoodsId,k(H.mealRevertDay));var K=k(H.mealRevertDay).split("-");g.chooseSendtime=K[0]+"年"+K[1]+"月"+K[2]+"日   "+K[3]}else{m(sgoodsId,k(0));var K=k(0).split("-");g.chooseSendtime=K[0]+"年"+K[1]+"月"+K[2]+"日   "+K[3]}for(var F=0;F<H.packageGoods.length;F++)J+=0==F?H.packageGoods[F].wmGoodsId+":"+H.packageGoods[F].goodsCount:";"+H.packageGoods[F].wmGoodsId+":"+H.packageGoods[F].goodsCount;I+=J,y=I}else{""!=storage.choooseThis&&(a.chooseSendtime=storage.chooseSendtimes),""!=storage.chooseSendtimesDuan&&(a.chooseTimezone=storage.chooseSendtimesDuan);var H=JSON.parse(storage.shopCart);if(y=[],0==H)window.location.href="#/tab/dash",$(".tab-nav").show();else if(H instanceof Array==0){var I="",J="";sgoodsId.push(H.wmGoodsId),sgoodsId=sgoodsId.join(","),I+=H.wmGoodsId+":"+H.buyCount+"A";for(var F=0;F<H.packageGoods.length;F++)J+=0==F?H.packageGoods[F].wmGoodsId+":"+H.packageGoods[F].goodsCount:";"+H.packageGoods[F].wmGoodsId+":"+H.packageGoods[F].goodsCount;I+=J,y.push(I)}else{for(var G=0;G<H.length;G++){var I="",J="";sgoodsId.push(H[G].wmGoodsId),I+=H[G].wmGoodsId+":"+H[G].buyCount+"A";for(var F=0;F<H[G].packageGoods.length;F++)J+=0==F?H[G].packageGoods[F].wmGoodsId+":"+H[G].packageGoods[F].goodsCount:";"+H[G].packageGoods[F].wmGoodsId+":"+H[G].packageGoods[F].goodsCount;I+=J,y.push(I)}sgoodsId=sgoodsId.join(","),m(sgoodsId,k(0));var K=k(0).split("-")}}storage.amount=a.hehe,storage.sgoodsId=sgoodsId,b.myValidCouponSrv().success(function(b){a.valueCouponNum=b.resultObj.length});var L=[];f.fromTemplateUrl("templates/datemodal.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b});var M=!1;a.changeSendtime=function(b){m(sgoodsId,b);var c=(a.houDate.split(","),a.houDate.split(","));if(c[1]>10&&(c[1]=c[1].substring(1,1)),c[2]>10&&(c[2]=c[2].substring(1,1)),c=c.join(","),"auto"==b)a.ifsmodal=!1,a.modal.show(),a.closedateModal=function(b){a.modal.hide(),a.sendDate=b,console.log(b),M=b,m(sgoodsId,b);var c=b.split("-");tDay="星期"+"日一二三四五六".charAt(new Date(b).getDay()),g.chooseSendtime=c[0]+"年"+c[1]+"月"+c[2]+"日"+tDay};else{a.others="auto",a.sendDate="auto";var d=b.split("-");g.chooseSendtime=d[0]+"年"+d[1]+"月"+d[2]+"日"+d[3]}};var M=!1,N=[];if(a.Details=[],"true"==ifNow){a.Details.push(JSON.parse(storage.shopOnce));for(var G=0;G<a.Details.length;G++){for(var O=a.Details[G].packageGoods,P={},Q="",F=0;F<O.length;F++)0!=O[F].goodsCount&&(Q+=0==Q.length?O[F].wmGoodsName+O[F].goodsCount+"份":","+O[F].wmGoodsName+O[F].goodsCount+"份");P={opei:Q},N.push(P)}a.peicai=N}else{var R=JSON.parse(storage.shopCart);if(R instanceof Array==0){var S=[];S.push(R),a.Details=S}else 0==R?(window.location.href="#/tab/dash",$(".tab-nav").show()):a.Details=R;if(0==R)window.location.href="#/tab/dash",$(".tab-nav").show();else{for(var G=0;G<a.Details.length;G++){for(var O=a.Details[G].packageGoods,P={},Q="",F=0;F<O.length;F++)0!=O[F].goodsCount&&(Q+=0==Q.length?O[F].wmGoodsName+O[F].goodsCount+"份":","+O[F].wmGoodsName+O[F].goodsCount+"份");P={opei:Q},N.push(P)}a.peicai=N}}a.ifLogintiao=function(){window.location.href="#/tab/selectAddr",localStorage.setItem("ifSelectAddr","1")},invoiceTitle=storage.companyName,a.other={beizhu:"",companyName:""},a.other.beizhu=storage.beizhus,storage.changeFp&&(a.fapiao=storage.changeFp,invoiceType=storage.changeFp,2==storage.changeFp&&storage.companyName&&(a.other.companyName=storage.companyName,a.xians=!0)),a.dinners=function(d,e,f,h,i,j,k){a.doing=!0,void 0!=p?(p=a.chooseSendtime,p=p.replace("年","-"),p=p.replace("月","-"),p=p.replace("日","-"),p=p.split("-"),p.pop(),p=p.join("-"),p=p+" "+a.chooseTimezone+":00"):(c.show({template:"请选择配送时段！"}),a.doing=!1,setTimeout(function(){c.hide()},1e3)),v=a.other.beizhu,"点我选择送餐时间"==a.chooseSendtime||void 0==a.chooseTimezone?(c.show({template:"请选择配送时段！"}),a.doing=!1,setTimeout(function(){c.hide()},1e3)):"没有收货人信息"==a.username?(c.show({template:"请选择配送地址！"}),a.doing=!1,setTimeout(function(){c.hide()},1e3)):a.yaof&&2==h&&""==i?""==i&&(c.show({template:"请填写发票公司名称！"}),a.doing=!1,setTimeout(function(){c.hide()},1e3)):(o=storage.timeId,b.allot(x,w,n,function(){b.buyDinner(n,o,p,q,r,1475,1476,s,t,u,v,y,h,i,d,e).success(function(d){d.result?(c.show({template:"下单成功"}),d.success?window.location.href="paysuccess.html":(setTimeout(function(){b.allot(x,w,d.orderId)},0),setTimeout(function(){c.hide();var a=g.base64encode(g.utf16to8(d.orderId.toString())),b=g.base64encode(g.utf16to8(d.widtotalFee.toString())),e=g.base64encode(g.utf16to8(d.cbalance.toString())),f=g.base64encode(g.utf16to8(d.balance.toString()));window.location.href="#/pay/"+a+"/"+b+"/"+e+"/"+f,"true"==ifNow||storage.setItem("shopCart",0)},1e3))):(c.show({template:d.message}),a.doing=!1,setTimeout(function(){c.hide()},1e3))})}))},changeSendtime=a.changeSendtime=function(b,c){if(console.log(b,c),void 0==c&&(c=0),a.dateArray=[{name:k(0,2),names:k(0,1),chinise:"今天",isActive:!1},{name:k(1,2),names:k(1,1),chinise:"明天",isActive:!1},{name:k(2,2),names:k(2,1),chinise:"后天",isActive:!1}],3>c){a.dateArray[c].isActive=!0,m(sgoodsId,b),a.others="auto",a.sendDate="auto";var d=b.split("-");a.chooseSendtime=d[0]+"年"+d[1]+"月"+d[2]+"日"+d[3],console.log(a.chooseSendtime)}"auto"==b&&(a.modal.show(),g.ifsmodal=!1,g.closedateModal=function(b){a.modal.hide(),g.ifsmodal=!0,a.sendDate=b,console.log(b),m(sgoodsId,b);var c=b.split("-");tDay="星期"+"日一二三四五六".charAt(new Date(b).getDay()),console.log(d),a.chooseSendtime=c[0]+"年"+c[1]+"月"+c[2]+"日"+tDay})},a.timetiao=function(){window.location.href="#/chosetime";var a=k(0,1);changeSendtime(a,0)}}]).controller("timeCtrl",["$scope","$interval","dinner","$ionicLoading","$rootScope","$ionicModal","myAddress",function(a,b,c,d,e,f,g){function h(a,b){var c=new Date,d=c.getTime()+864e5*a;c.setTime(d);var e=c.getFullYear(),f=c.getMonth(),g=c.getDate(),h=c.getDay();return f=i(f+1),g=i(g),h="星期"+"日一二三四五六".charAt(h),1==b?e+"-"+f+"-"+g+"-"+h:f+"-"+g+" "+h}function i(a){var b=a;return 1==a.toString().length&&(b="0"+a),b}function j(b,e){if(d.show(),2015!=e.split("-")[0]&&(e=e.split("-"),e[0]=2015,e=e.join("-"),console.log(e+"0")),2==e.split("-").length){e=e.split("-"),dates2=e[1].split(" ");var f=(new Date).getMonth();++f,f=10>f?"0"+f:f,dates2.unshift(f),dates2=dates2.join("-"),e[1]=dates2,e=e.join("-")}c.getAllTime(b,e).success(function(c){console.log(b,e),n=c.timeList;for(var f=0;f<n.length;f++)n[f].timePoint=n[f].timePoint.substring(0,5),n[f].active=!1;a.wuTimeZone=[],a.wanTimeZone=[],a.yeTimeZone=[],a.xiaTimeZone=[];for(var f=0;f<n.length;f++)n[f].timePoint>"08:00"&&n[f].timePoint<"15:00"?a.wuTimeZone.push(n[f]):n[f].timePoint>="15:00"&&n[f].timePoint<"18:00"?a.xiaTimeZone.push(n[f]):n[f].timePoint>="18:00"&&n[f].timePoint<"21:00"?a.wanTimeZone.push(n[f]):a.yeTimeZone.push(n[f]);a.$apply(),d.hide()}).error(function(){d.hide(),$state.go("login")})}if(g.addressListSrv().success(function(a){"未登录"==a.message?window.location.href="#/login":(storage.setItem("ifLogin",!0),window.location.href="#/chosetime")}),a.ToDay=h(0,2),a.ToMorrow=h(1,2),a.AfterDay=h(2,2),a.ToDay1=h(0,1),a.ToMorrow1=h(1,1),a.AfterDay1=h(2,1),a.closesss=function(){},a.choooseThis=function(b,c){for(var d=0;d<n.length;d++)n[d].active=!1;e.chooseTimezone=c.timePoint,c.active=!0,timeId=c.id,storage.setItem("timeId",c.id),e.chooseTimezone>"20:00"?a.showYeXiaoTips=!0:a.showYeXiaoTips=!1;var f=a.chooseSendtime.split("日")[0],g=f.split("年")[0],h=f.split("年")[1].split("月")[0],i=f.split("月")[1];storage.setItem("chooseSendtimes",a.chooseSendtime),storage.setItem("chooseSendtimesDuan",e.chooseTimezone),e.requireTime=g+"-"+h+"-"+i+" "+a.chooseTimezone+":00",storage.requireTimeForCoupon=e.requireTime,void 0===storage.couponValue||"0"===storage.couponValue||(storage.couponValue=0,storage.couponId="",alert("选定的时间发生变化，请重选优惠券")),window.location.href="#/haslogindinner"},a.dateArray=[{name:h(0,2),names:h(0,1),chinise:"今天",isActive:!0},{name:h(1,2),names:h(1,1),chinise:"明天",isActive:!1},{name:h(2,2),names:h(2,1),chinise:"后天",isActive:!1}],ifNow=storage.ifNow,sgoodsId=[],a.ifcan=!1,"true"==ifNow){var k=JSON.parse(storage.shopOnce);shopcardata="";var l="";sgoodsId.push(k.wmGoodsId),sgoodsId=sgoodsId.join(","),l+=k.wmGoodsId+":"+k.buyCount+"A",k.mealRevertDay>0?j(sgoodsId,h(k.mealRevertDay)):j(sgoodsId,h(0))}else{var k=JSON.parse(storage.shopCart);if(shopcardata=[],0==k);else if(k instanceof Array==0){var l="";sgoodsId.push(k.wmGoodsId),sgoodsId=sgoodsId.join("")}else{for(var m=0;m<k.length;m++){var l="";sgoodsId.push(k[m].wmGoodsId)}sgoodsId=sgoodsId.join(",")}}var n=[];f.fromTemplateUrl("templates/datemodal.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b}),changeSendtime=a.changeSendtime=function(b,c){if(console.log(b,c),void 0==c&&(c=0),a.dateArray=[{name:h(0,2),names:h(0,1),chinise:"今天",isActive:!1},{name:h(1,2),names:h(1,1),chinise:"明天",isActive:!1},{name:h(2,2),names:h(2,1),chinise:"后天",isActive:!1}],3>c){a.dateArray[c].isActive=!0,j(sgoodsId,b),a.others="auto",a.sendDate="auto";var d=b.split("-");a.chooseSendtime=d[0]+"年"+d[1]+"月"+d[2]+"日"+d[3],console.log(a.chooseSendtime)}"auto"==b&&(a.modal.show(),e.ifsmodal=!1,e.closedateModal=function(b){a.modal.hide(),e.ifsmodal=!0,a.sendDate=b,console.log(b),j(sgoodsId,b);var c=b.split("-");tDay="星期"+"日一二三四五六".charAt(new Date(b).getDay()),console.log(d),a.chooseSendtime=c[0]+"年"+c[1]+"月"+c[2]+"日"+tDay})},time=h(0,1),index=0,a.dateArray[index].isActive=!0,j(sgoodsId,time),a.others="auto",a.sendDate="auto";var n=time.split("-");a.chooseSendtime=n[0]+"年"+n[1]+"月"+n[2]+"日"+n[3],console.log(a.chooseSendtime);var o=h(0,1);changeSendtime(o,0)}]).controller("commentController",["comment","$scope","myBill","amap","myAddress","$state","$ionicLoading","$stateParams",function(a,b,c,d,e,f,g,h){b.dish={};var i=0;b.list=[];var j=h.id;a.getGoods(j).success(function(a){for(var c=0;c<a.wmGoodsPicList.length;c++)if(1==a.wmGoodsPicList[c].picType){b.dish.img=a.wmGoodsPicList[c].imageSrc;break}b.dish.price=a.goodsPrice,b.dish.name=a.wmGoodsName,b.dish.id=a.wmGoodsId}),b.getMoreComment=function(){a.list(i,j).success(function(a){if(0==a.length)$(".spinner,.getMore").hide(),g.show({template:"没有更多了"}),setTimeout(function(){g.hide()},1e3);else{for(var c=0;c<a.length;c++){var d=[];if(null!=a[c].commentImage)for(var e=a[c].commentImage.split(","),f=0;f<e.length;f++){var h=e[f].lastIndexOf("image/")+6;if(-1!=h)var j=e[f].substring(0,h),k=e[f].substring(h);var l={url:j,name:k};d.push(l)}var h=a[c].userName.substring(0,3),m=a[c].userName.substring(7),h={head:"img/test3.jpg",content:a[c].content,imgs:d,name:h+"****"+m,id:a[c].commentId,createTime:a[c].createTime};b.list.push(h)}i=b.list[b.list.length-1].id,b.$broadcast("scroll.infiniteScrollComplete")}})},a.list(i,j).success(function(a){for(var c=[],d=0;d<a.length;d++){var e=[];if(null!=a[d].commentImage)for(var f=a[d].commentImage.split(","),g=0;g<f.length;g++){var h=f[g].lastIndexOf("image/")+6;if(-1!=h)var j=f[g].substring(0,h),k=f[g].substring(h);var l={url:j,name:k};e.push(l)}if(null!=a[d].userName){var h=a[d].userName.substring(0,3),m=a[d].userName.substring(7),h={head:"img/test3.jpg",content:a[d].content,imgs:e,name:h+"****"+m,id:a[d].commentId,createTime:a[d].createTime};c.push(h)}}b.list=c,c.length>0&&(i=c[c.length-1].id)}),b.clk=function(a){for(var c=0;c<b.list.length;c++)b.list[c].show=!1;b.list[a.index].show=!0},b.sub=function(a){a.index<b.list.length-1&&(b.list[a.index].show=!1,b.list[a.index+1].show=!0)},b.choice=function(a){for(var c=0;c<=a.index;c++)b.ranks[c].sty="iconfont jbg-favorfill xingxing";for(var c=a.index+1;c<b.ranks.length;c++)b.ranks[c].sty="iconfont jbg-favor xingxing_"}}]).controller("shaid2Controller",["shaid","$scope","myBill","amap","myAddress","$state","$ionicLoading","$stateParams","$ionicPopup",function(a,b,c,d,e,f,g,h,i){var j=0;b.remove=function(a,c){var d=b.list[a.index].imageIds.split(",");d.splice(d.length-1,1),d.splice(c,1),b.list[a.index].imageIds="";for(var e=0;e<d.length;e++)void 0!=d[c]&&""!=d[c]&&(b.list[a.index].imageIds+=d[e]+",");0==d.length&&(b.list[a.index].imageIds=""),b.list[a.index].imgs.splice(c,1)};var k=function(a){for(var c=0;c<a.length;c++)$(a[c]).fileupload({url:ajaxPath+"/comment/Comment!uploadImage",dataType:"json",autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:2e6,done:function(a,c){g.hide(),b.$apply(function(){b.list[j].imageIds+=c.result.res_id+",",b.list[j].imgs.push(c.result.url)})},progressall:function(a,b){}}).on("fileuploadprocessalways",function(a,b){g.show({template:"正在上传..."}),b.files.error&&(g.show({template:b.files[0].error}),setTimeout(function(){g.hide()},1e3))})};b.list=[];var l=h.id;a.list(l).success(function(a){for(var c=[],d=0,e=0;e<a.length;e++)0==a[e].isCommented&&"0"==a[e].upGoodsId&&(a[e].index=d,a[e].imgs=[],a[e].show=!1,a[e].bshow=!0,a[e].goodsScore=5,a[e].imageIds="",a[e].ranks=[{sty:"iconfont jbg-favorfill xingxing",index:0},{sty:"iconfont jbg-favorfill xingxing",index:1},{sty:"iconfont jbg-favorfill xingxing",index:2},{sty:"iconfont jbg-favorfill xingxing",index:3},{sty:"iconfont jbg-favorfill xingxing",index:4}],c.push(a[e]),d++);c.length>0?c[0].show=!0:(g.show({template:"没有要晒单的商品 - -"}),setTimeout(function(){g.hide(),window.history.go(-1)},2e3)),b.list=c}),b.cameraclk=function(a){var b=0,c=$("input[name='file']");0==b&&(b++,k(c)),setTimeout(function(){$(c[a.index]).click()},0),j=a.index};b.choiceUpload=function(){$("#fileupload").click()},b.clk=function(a){for(var c=0;c<b.list.length;c++)b.list[c].show=!1;b.list[a.index].show=!0},b.sub=function(c,d){(void 0==c.content||""==c.content)&&(c.content="那滋味，爽啊"),a.sendGoodsComment(c).success(function(a){
a.result?(g.show({template:a.message}),setTimeout(function(){g.hide()},1e3),b.list[c.index].bshow=!1,c.index<b.list.length-1&&(b.list[c.index].show=!1,b.list[c.index+1].show=!0)):(g.show({template:a.message}),setTimeout(function(){g.hide()},1e3))})},b.choice=function(a,c){for(var d=0;d<=c.index;d++)b.list[a.index].ranks[d].sty="iconfont jbg-favorfill xingxing";for(var d=c.index+1;d<b.list[a.index].ranks.length;d++)b.list[a.index].ranks[d].sty="iconfont jbg-favor xingxing_";b.list[a.index].goodsScore=c.index+1}}]).controller("shaidController",["$stateParams","shaid","$scope","myBill","amap","myAddress","$state","$ionicLoading",function(a,b,c,d,e,f,g,h){c.xxs=[{sty:"iconfont jbg-favorfill xingxing",index:0},{sty:"iconfont jbg-favorfill xingxing",index:1},{sty:"iconfont jbg-favorfill xingxing",index:2},{sty:"iconfont jbg-favorfill xingxing",index:3},{sty:"iconfont jbg-favorfill xingxing",index:4}],c.xxs_kd=[{sty:"iconfont jbg-favorfill xingxing",index:0},{sty:"iconfont jbg-favorfill xingxing",index:1},{sty:"iconfont jbg-favorfill xingxing",index:2},{sty:"iconfont jbg-favorfill xingxing",index:3},{sty:"iconfont jbg-favorfill xingxing",index:4}],c.scsj_yes=!0,c.scsj_no=!1;var i=a.id;c.order={},b.getOrderById(i).success(function(a){c.order=a,c.order.orderScore=5,c.order.courierScore=5}),c.sendOrderComment=function(){void 0==c.order.content&&(c.order.content=""),b.sendOrderComment(c.order).success(function(a){a.result?(h.show({template:a.message}),setTimeout(function(){h.hide(),window.history.go(-1)},1e3)):(h.show({template:a.message}),setTimeout(function(){h.hide()},1e3))})},c.scsj_yes_fk=function(a){c.scsj_yes?c.scsj_yes=!1:(c.scsj_yes=!0,c.scsj_no=!1)},c.scsj_no_fk=function(a){c.scsj_no?c.scsj_no=!1:(c.scsj_no=!0,c.scsj_yes=!1)},c.choice=function(a){c.order.orderScore=a.index+1;for(var b=0;b<=a.index;b++)c.xxs[b].sty="iconfont jbg-favorfill xingxing";for(var b=a.index+1;b<c.xxs.length;b++)c.xxs[b].sty="iconfont jbg-favor xingxing_"},c.choice_kd=function(a){c.order.courierScore=a.index+1;for(var b=0;b<=a.index;b++)c.xxs_kd[b].sty="iconfont jbg-favorfill xingxing";for(var b=a.index+1;b<c.xxs.length;b++)c.xxs_kd[b].sty="iconfont jbg-favor xingxing_"}}]).controller("tabCtl",["$scope","$ionicLoading",function(a,b){if(a.arr.cartLength=0,storage.shopCart){var c=storage.shopCart,d=0;if(c=JSON.parse(c),0==c)a.arr.cartLength=0;else if(c instanceof Array==0)a.arr.cartLength=c.buyCount;else{for(var e=0;e<c.length;e++)d+=c[e].buyCount;a.arr.cartLength=d}}else a.arr.cartLength=0,storage.setItem("shopCart",0)}]),angular.module("starter.services",[]).factory("shopList",["$http",function(a){return{all:function(){return a.jsonp(ajaxPath+"/mall/WmGoods!getMealList?callback=JSON_CALLBACK&firstId=&t="+(new Date).getTime())}}}]).factory("shopDetail",["$http",function(a){return{all:function(b){return a.jsonp(ajaxPath+"/mall/WmGoods!getMealDetails?callback=JSON_CALLBACK&wmGoodsId="+b+"&t="+(new Date).getTime())}}}]).factory("shopCart",["$http",function(a){return{all:function(){return a.get("json/shopcart.json")}}}]).factory("rank",["$http",function(a){return{all:function(){return a.get("json/rank.json")}}}]).factory("register",["$http",function(a){return{regSrv:function(b,c){return a.jsonp(ajaxPath+"/frame/Login!register?callback=JSON_CALLBACK&phoneCode="+b+"&password="+c+"&t="+(new Date).getTime())}}}]).factory("verifCode",["$http",function(a){return{verifCodeSrv:function(b){return a.jsonp(ajaxPath+"/frame/Login!getVerifCode?callback=JSON_CALLBACK&phoneCode="+b+"&t="+(new Date).getTime())}}}]).factory("resetPwd",["$http",function(a){return{resetPwdSrv:function(b,c,d){return a.jsonp(ajaxPath+"/frame/Login!resetPassword?callback=JSON_CALLBACK&phoneCode="+b+"&password="+c+"&VerificationCode="+d+"&t="+(new Date).getTime())}}}]).factory("login",["$http",function(a){return{logSrv:function(b,c){return a.jsonp(ajaxPath+"/frame/Login!getPhoneCheckCode?callback=JSON_CALLBACK&phoneCode="+b+"&VerificationCode="+c+"&t="+(new Date).getTime())},isLogSrv:function(){return a.jsonp(ajaxPath+"/frame/Login!getLoginUser?callback=JSON_CALLBACK&t="+(new Date).getTime())}}}]).factory("userCenter",["$http",function(a){return{getUserInforSrv:function(){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getUserInfo?callback=JSON_CALLBACK&t="+(new Date).getTime())},SignOutSrv:function(){return a.jsonp(ajaxPath+"/frame/Login!SignOut?callback=JSON_CALLBACK&t="+(new Date).getTime())}}}]).factory("myBill",["$http",function(a){return{getMyBillSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getBillList?callback=JSON_CALLBACK&firstId="+b+"&t="+(new Date).getTime())},getNoPayBillSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getNoPayBillList?callback=JSON_CALLBACK&firstId="+b+"&t="+(new Date).getTime())},getMyBillDoneSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getBillListDone?callback=JSON_CALLBACK&firstId="+b+"&t="+(new Date).getTime())},getBillCommentSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getBillListComment?callback=JSON_CALLBACK&firstId="+b+"&t="+(new Date).getTime())},getRefundBillSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getRefundBillList?callback=JSON_CALLBACK&firstId="+b+"&t="+(new Date).getTime())},sendSignSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!sendSign?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())},sendRefundSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!sendRefund?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())},cancelOrderSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!cancelOrder?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())}}}]).factory("myCoupon",["$http",function(a){return{myCouponSrv:function(){return a.jsonp(ajaxPath+"/coupon/Coupon!getUserCoupon?callback=JSON_CALLBACK&t="+(new Date).getTime())},bindCouponSrv:function(b,c){return a.jsonp(ajaxPath+"/coupon/Coupon!bindCoupon?callback=JSON_CALLBACK&couponCode="+b+"&couponPwd="+c+"&t="+(new Date).getTime())}}}]).factory("myAccount",["$http",function(a){return{myAccountSrv:function(){return a.jsonp(ajaxPath+"/mall/WmUser!blance?callback=JSON_CALLBACK&t="+(new Date).getTime())},myAccountListSrv:function(){return a.jsonp(ajaxPath+"/mall/WmUser!orderListInfo?callback=JSON_CALLBACK&t="+(new Date).getTime())}}}]).factory("faHongBao",["$http",function(a){return{bindUserSrv:function(b){return a.jsonp(ajaxPath+"/mall/WmGoods!refer?callback=JSON_CALLBACK&key=R6JKMMLXL540QYJJUFD&userId="+b+"&t"+(new Date).getTime())},logSrv:function(b,c){return a.jsonp(ajaxPath+"/frame/Login!getPhoneCheckCode2?callback=JSON_CALLBACK&phoneCode="+b+"&VerificationCode="+c+"&t="+(new Date).getTime())},isRegisterSrv:function(b){return a.jsonp(ajaxPath+"/frame/Login!isRegister?callback=JSON_CALLBACK&phoneCode="+b+"&t="+(new Date).getTime())},fenfa:function(b){return a.jsonp(ajaxPath+"/mall/WmGoods!refer?callback=JSON_CALLBACK&key=WVQPDWDHAD2ZQ5BEHGA&userId="+b+"&t"+(new Date).getTime())},fenXiaoShangBind:function(b,c){return a.jsonp(ajaxPath+"/frame/Login!getPhoneCheckCodeF?callback=JSON_CALLBACK&phoneCode="+b+"&VerificationCode="+c+"&t="+(new Date).getTime())}}}]).factory("localPush",["$http",function(a){return{localPushRuleSrv:function(b){return a.jsonp(ajaxPath+"/mall/WmGoods!access?callback=JSON_CALLBACK&key="+b+"&t"+(new Date).getTime())},localPushlogSrv:function(b,c){return a.jsonp(ajaxPath+"/frame/Login!getPhoneCheckCode3?callback=JSON_CALLBACK&phoneCode="+b+"&VerificationCode="+c+"&t="+(new Date).getTime())},isRegisterSrv:function(b){return a.jsonp(ajaxPath+"/frame/Login!isRegister?callback=JSON_CALLBACK&phoneCode="+b+"&t="+(new Date).getTime())}}}]).factory("myAddress",["$http","amap","$ionicLoading","$state",function(a,b,c,d){return{addressListSrv:function(){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getUserAddrInfo?callback=JSON_CALLBACK&t="+(new Date).getTime())},addressListSrvDefault:function(){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getUserAddrInfoDefault?callback=JSON_CALLBACK&t="+(new Date).getTime())},setDefaultAddSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!setDefaultAddress?callback=JSON_CALLBACK&addrId="+b+"&t="+(new Date).getTime())},deleteAddSrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!deleteUserAddress?callback=JSON_CALLBACK&addrId="+b+"&t="+(new Date).getTime())},getOrg:function(){return a.jsonp(ajaxPath+"/system/Sys_organization!getOrg?callback=JSON_CALLBACK")},save:function(b,c,d){void 0==b.defaultAdd?b.defaultAdd=1:b.defaultAdd?b.defaultAdd=1:b.defaultAdd=0;var e="wmAddr.is_default="+b.defaultAdd+"&wmAddr.receiver_name="+b.receiverName+"&wmAddr.receiver_tel="+b.receiverTel+"&wmAddr.receiver_province=1475&wmAddr.receiver_city=1476&wmAddr.receiver_area="+b.area+"&wmAddr.receiver_address="+b.infoaddr+"&wmAddr.receiver_street="+b.receiverAddress+"&wmAddr.lat="+b.lat+"&wmAddr.lng="+b.lng;return storage.setItem("addInfor",JSON.stringify(b)),a.jsonp(ajaxPath+"/cust/WmCustCenter!addUserAddress?callback=JSON_CALLBACK&"+e).success(d)}}}]).factory("amap",["$http",function(a){return{getLocation:function(a){navigator.geolocation&&navigator.geolocation.getCurrentPosition(a)},drivingByName:function(a){AMap.service("AMap.Driving",function(){var b=2,c="base";void 0!=a.policy&&(b=a.policy),void 0!=a.extensions&&(c=a.extensions),walking=new AMap.Driving({policy:b,extensions:c}),keywords=[],keywords.push({keyword:a.start,city:a.city},{keyword:a.end,city:a.city}),walking.search(keywords,function(b,c){"complete"===b?(void 0!=a.success&&a.success(c,a),console.log(JSON.stringify(c))):void 0!=a.error&&a.error(b,a)})})},getCity:function(a){AMap.service(["AMap.CitySearch"],function(){var b=new AMap.CitySearch;b.getLocalCity(function(b,c){"complete"===b&&"OK"===c.info?c&&c.city&&c.bounds&&a(c.city):a(c.info)})})},driving:function(a){if(void 0!=a){var b="base",c=2;void 0!=a.policy&&(c=a.policy),void 0!=a.extensions&&(b=a.extensions),AMap.service(["AMap.Driving"],function(){var d=new AMap.Driving({policy:c,extensions:b});d.search(a.start,a.end,function(b,c){"complete"===b&&"OK"===c.info?void 0!=a.success&&a.success(c,a):void 0!=a.error&&a.error(error)})})}},autoSearch:function(a){if(void 0!=a){var b="";void 0!=a.name&&(b=a.name),AMap.service(["AMap.Autocomplete"],function(){var c=new AMap.Autocomplete;b.length>0&&void 0!=a.success&&(AMap.event.addListener(c,"complete",a.success),void 0!=a.adcode&&c.setCity(a.adcode),c.search(b))})}},placeSearch:function(a){void 0!=a&&AMap.service(["AMap.PlaceSearch"],function(){var b="base";void 0!=a.extensions&&(b=a.extensions);var c=new AMap.PlaceSearch({pageIndex:a.index,pageSize:a.size,city:a.adcode,extensions:b});c.search(a.name,function(b,c){"complete"===b&&"OK"===c.info?void 0!=a.success&&a.success(c):void 0!=a.error&&a.error(c)})})},geocoder:function(a){if(void 0!=a){var b="",c="",d=1e3;void 0!=a.adcode&&(b=a.adcode),void 0!=a.name&&(c=a.name),void 0!=a.radius&&(d=a.radius),AMap.service(["AMap.Geocoder"],function(){var e=new AMap.Geocoder({city:b,radius:d});e.getLocation(c,function(b,c){"complete"===b&&"OK"===c.info?void 0!=a.success&&a.success(c):void 0!=a.error&&a.error(b,c)})})}},getAddress:function(a){if(void 0!=a){var b="",c="",d=1e3;void 0!=a.adcode&&(b=a.adcode),void 0!=a.name&&(c=a.name),AMap.service(["AMap.Geocoder"],function(){var c=new AMap.Geocoder({city:b,radius:d});c.getAddress(a.xy,function(b,c){"complete"===b&&"OK"===c.info?void 0!=a.success&&a.success(c):void 0!=a.error&&a.error(b,c)})})}}}}]).factory("payMethod",["$http",function(a){return{alipaySrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!sendPay?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())},wxSignSrv:function(b){return a.jsonp(ajaxPath+"/weixin/Sign!getSign&t="+(new Date).getTime())},accountPaySrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!sendBlance?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())},couponPaySrv:function(b,c){return a.jsonp(ajaxPath+"/coupon/Coupon!sendCouponPay?callback=JSON_CALLBACK&orderId="+b+"&couponId="+c+"&t="+(new Date).getTime())},bankPaySrv:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!sendAlinPay?callback=JSON_CALLBACK&orderId="+b+"&t="+(new Date).getTime())}}}]).factory("dinner",["$http",function(a){return{myValidCouponSrv:function(){return a.jsonp(ajaxPath+"/coupon/Coupon!getValidCoupon?goodsIds="+window.localStorage.sgoodsId+"&orderAmount="+window.localStorage.amount+"&requireTime="+window.localStorage.requireTimeForCoupon+"&callback=JSON_CALLBACK&t="+(new Date).getTime())},getDefaultAddr:function(){return a.jsonp(ajaxPath+"/waimai/WmOrder!getUserDefaultAddr?callback=JSON_CALLBACK&t="+(new Date).getTime())},getChooseTime:function(b){return a.jsonp(ajaxPath+"/waimai/WmOrder!getDeliveryTimeListByDay?callback=JSON_CALLBACK&day="+b+"&t="+(new Date).getTime())},getAllTime:function(b,c){return a.jsonp(ajaxPath+"/waimai/WmOrder!getGoodsTimeList?callback=JSON_CALLBACK&goodsIds="+b+"&day="+c+"&t="+(new Date).getTime())},buyDinner:function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a.jsonp(ajaxPath+"/waimai/WmOrder!placeAnOrder?callback=JSON_CALLBACK&orderParam.addrId="+b+"&orderParam.timeId="+c+"&orderParam.requireTime="+d+"&orderParam.receiverName="+e+"&orderParam.receiverTel="+f+"&orderParam.receiverProvince="+g+"&orderParam.receiverCity="+h+"&orderParam.receiverArea="+i+"&orderParam.receiverStreet="+j+"&orderParam.receiverAddress="+k+"&orderParam.remark="+l+"&orderParam.shopcardata="+m+"&orderParam.invoiceType="+n+"&orderParam.invoiceTitle="+o+"&orderParam.couponId="+p+"&orderParam.blance="+q+"&t="+(new Date).getTime())},allot:function(b,c,d,e){a.jsonp(ajaxPath+"/waimai/Map!getOrg?callback=JSON_CALLBACK").success(function(f){var g="";for(var h in f)if(void 0!=f[h].addrArry&&null!=f[h].addrArry&&f[h].addrArry.length>0){var i=f[h].addrArry.split(";"),j=new Array;for(var k in i){var l=i[k].split(",");j.push(new AMap.LngLat(l[0],l[1]))}var m=new AMap.Polygon({path:j});m.contains(new AMap.LngLat(b,c))&&(g+=f[h].org_id+",")}a.jsonp(ajaxPath+"/waimai/Map!allot?callback=JSON_CALLBACK&wm_address_id="+d+"&orgs="+g).success(function(a){void 0!=e&&e()})})}}}]).factory("shaid",["$http",function(a){return{list:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getOrderItemList?callback=JSON_CALLBACK&orderId="+b)},sendGoodsComment:function(b){var c="goodsId="+b.wmGoodsId+"&goodsScore="+b.goodsScore+"&content="+b.content+"&imageIds="+b.imageIds+"&wmOrderItemId="+b.wmOrderItemId;return a.jsonp(ajaxPath+"/comment/Comment!sendGoodsComment?callback=JSON_CALLBACK&"+c)},getOrderById:function(b){return a.jsonp(ajaxPath+"/cust/WmCustCenter!getOrderById?callback=JSON_CALLBACK&orderId="+b)},checkOrderComment:function(b){return a.jsonp(ajaxPath+"/comment/Comment!checkOrderComment?callback=JSON_CALLBACK&orderId="+b)},sendOrderComment:function(b){void 0==b.orderScore&&(b.orderScore=-1),void 0==b.courierScore&&(b.courierScore=-1),void 0==b.content&&(b.content="");var c="orderId="+b.orderId+"&orderScore="+b.orderScore+"&courierScore="+b.courierScore+"&content="+b.content+"&isOnTime="+b.isOnTime;return a.jsonp(ajaxPath+"/comment/Comment!sendOrderComment?callback=JSON_CALLBACK&"+c)}}}]).factory("comment",["$http",function(a){return{list:function(b,c){return a.jsonp(ajaxPath+"/comment/Comment!getGoodsComment?callback=JSON_CALLBACK&firstId="+b+"&goodsId="+c)},getGoods:function(b){return a.jsonp(ajaxPath+"/mall/WmGoods!getMealDetails?callback=JSON_CALLBACK&wmGoodsId="+b)}}}]);